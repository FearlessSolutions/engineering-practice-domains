# Swagger

Swagger documentation for microservices in this template is generated from annotations in comments via the [swag](https://github.com/swaggo/swag) 
library. The swagger documentation is then rendered via a pre-built controller made for Echo: [echo-swagger](https://github.com/swaggo/echo-swagger)

## Building

You will need to [install swaggo/swag](https://github.com/swaggo/swag#getting-started) and then add `export PATH=$(go env GOPATH)/bin:$PATH` to your .bashrc or .zshrc to add the `swag` tool to your PATH.

You can regenerate the swagger documentation from the source code via `swag init --parseDependency --parseVendor`, but this is also done automatically by running `go generate ./...` at the root of the repository.

## Microservice Annotations Example

In the file [microsvc/main.go](../microsvc/main.go) we see the annotations used for the basic swagger project information.
The original repository's [README](https://github.com/swaggo/swag) goes over these options in detail, but the ones present there set high-level information listed at the top of the swagger UI
such as the name of the API, the port number the app serves on, the app's base URL, and more.

## Annotating an Endpoint

The file [microsvc/features/sample/controller/controller.go](../microsvc/features/sample/controller/controller.go) contains an example on how to annotate REST API endpoints using the swag CLI.
The original repository's [README](https://github.com/swaggo/swag) goes into these annotations in more depth, but you'll generally be using these on most API endpoints:

* `@summary` - Gives a high level description of what the endpoint does
* `@description` - Gives a more in-depth description of the endpoint that is displayed when the endpoint is expanded
* `@tags` - A comma-separated list of API groups this endpoint belongs to. Endpoints with the same tag will be grouped in the Swagger UI.
* `@accept` - The MIME type accepted by this endpoint.
* `@produce` - The MIME type of the data produced by this endpoint's response.
* `@param` - A parameter to the request - either a header, path parameter, query parameter, or the request body. Formatted space-separated as `PARAM_NAME SOURCE TYPE REQUIRED DESCRIPTION`
* `@success` - Describes the response produced from a successful call to the endpoint. Formatted space-separated as `HTTP_STATUS_CODE {object} RESPONSE_TYPE DESCRIPTION`
* `@failure` - Just like `@Success`, but describes a failure response from the endpoint
* `@router` - Defines the URL that the endpoint is accessible from. Formatted space-separated as `API_PATH [HTTP_VERB]`

As an example, this is what the endpoint annotation would look like:

```go
package sample

import "github.com/labstack/echo/v4"

// DoSomething does a really cool thing to an entity indicated by the ID in the request path.
//
// @summary This endpoint does something.
// @description A more in-depth description of what the endpoint does
// @tags NeatEndpoints
// @accept json
// @produce json
// @param id path number true "The ID of the thing to do something to"
// @param changeRequest body MyNeatDto true "The set of things to do"
// @success 200 {object} DoSomethingResponse "The change was applied successfully"
// @failure 409 {object} dtos.apiError "The change failed to apply due to conflicting information"
// @failure 400 {object} dtos.apiError "The requested change had empty or missing fields"
// @router /api/v1/things/{id} [patch]
func (t Controller) DoSomething(ctx echo.Context, someDto MyNeatDto) error {
    /* ... */
}
```

## Annotating DTOs

The file [microsvc/features/sample/controller/dtos.go](../microsvc/features/sample/controller/dtos.go) contains an example of struct tags
being applied to DTOs so they appear properly when rendered in the swagger UI.

The full set of struct tags you can apply to DTOs is described in the [swag README](https://github.com/swaggo/swag?tab=readme-ov-file#available), but the
most common ones you'll use are:

* `json` - This struct tag specifies both how the field will be named in JSON output and also in the swagger UI.
* `validate:"required"` - Marks this field as required
* `example` - Specify an example value that should be rendered for this field in the swagger UI.

Here's an example of these struct tags applied to a DTO:

```go
type SampleGreetingResponse struct {
	Greeting string `json:"greeting" validate:"required" example:"Hello World"`
}
```

## Generated files

Files generated by either `go generate` or `swag init` are placed in the `docs` folder of a microservice.
